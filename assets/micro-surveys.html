<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Micro Surveys | I-REACCH</title>

  <!-- Reuse site styling -->
  <link rel="stylesheet" href="assets/css/brand.css">
  <link rel="stylesheet" href="assets/css/header.css">
  <link rel="stylesheet" href="assets/css/style.css">

  <style>
    .runner { display:grid; grid-template-columns: 320px 1fr; gap:20px; }
    @media (max-width: 980px){ .runner { grid-template-columns: 1fr; } }
    .panel { background:#fff; border-radius:12px; box-shadow: 0 4px 12px rgba(0,0,0,.08); }
    .panel .hd { padding:16px 18px; border-bottom:1px solid #e9eef6; }
    .panel .bd { padding:16px 18px; }
    .list { display:flex; flex-direction:column; gap:10px; }
    .item { display:flex; gap:10px; align-items:center; justify-content:space-between;
            padding:12px 14px; border:1px solid #e9eef6; border-radius:10px; cursor:pointer; }
    .item:hover { background:#f7fbff; }
    .item.active { outline:2px solid #9b51e0; background:#f9f3ff; }
    .title { font-weight:600; color:#1b2a41; }
    .sub { font-size:12px; color:#66788a; }
    .badges { display:flex; gap:6px; align-items:center; }
    .badge { font-size:11px; padding:3px 8px; border-radius:999px; background:#eef4ff; color:#2f5d98; }
    .badge.done { background:#e7f8ec; color:#207a3c; }
    .controls { display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .btn { appearance:none; border:0; padding:10px 14px; border-radius:999px; font-weight:700; color:#fff;
           background:linear-gradient(135deg,#5b2ca1,#00b0f0); cursor:pointer; }
    .btn.secondary { background:#eef4ff; color:#2f5d98; }
    iframe { width:100%; height:600px; border:0; border-radius:10px; background:#fff; }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="site-header">
    <div class="container bar">
      <a class="logo" href="index.html"><img src="assets/img/ireacch-logo.png" alt="I-REACCH"></a>
      <nav id="primary-nav" class="nav" aria-label="Primary">
        <a href="index.html">Home</a>
        <a href="micro-surveys.html" class="active"><strong>Surveys</strong></a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container content">
      <h1>Micro surveys</h1>
      <p>Each survey has only one question. Quick to answer — your input matters!</p>
    </div>
  </section>

  <!-- Runner -->
  <main class="container content" style="padding-bottom:64px">
    <div class="runner">
      <!-- Left: list -->
      <aside class="panel">
        <div class="hd"><strong>All questions</strong></div>
        <div class="bd">
          <div id="list" class="list"></div>
        </div>
      </aside>

      <!-- Right: survey embed -->
      <section class="panel">
        <div class="hd">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
            <div>
              <div id="currTitle" class="title">Select a micro survey</div>
              <div id="currMeta" class="sub"></div>
            </div>
            <div class="badges"><span id="currBadge" class="badge">New</span></div>
          </div>
        </div>
        <div class="bd">
          <iframe id="formFrame" title="Survey"></iframe>
          <div class="controls">
            <button id="markDone" class="btn">I’ve submitted this survey</button>
            <button id="nextBtn" class="btn secondary">Next unfinished</button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    // Your surveys here
    const SURVEYS = [
      {
        id: "survey1",
        title: "Research culture (Q1)",
        minutes: 1,
        audience: "Staff/PGR",
        url: "https://forms.office.com/Pages/ResponsePage.aspx?id=as2-rtQxAUuVzoJ0r-hT2buX6ZV7MhVCmSvPlC6dFa1UQ09CV1JUOEhQVUZXWUtOWFZPOVY1OUdZQy4u&embed=true"
      }
      // add more surveys here later
    ];

    const key = id => `micro.${id}.done`;
    const isDone = id => localStorage.getItem(key(id)) === 'true';
    const setDone = id => localStorage.setItem(key(id),'true');

    const $list = document.getElementById('list');
    const $frame = document.getElementById('formFrame');
    const $title = document.getElementById('currTitle');
    const $meta  = document.getElementById('currMeta');
    const $badge = document.getElementById('currBadge');
    const $next  = document.getElementById('nextBtn');
    const $mark  = document.getElementById('markDone');

    let current = null;

    function renderList(activeId){
      $list.innerHTML = SURVEYS.map(s => {
        const done = isDone(s.id);
        const active = s.id === activeId ? 'active' : '';
        const status = done ? '<span class="badge done">Completed</span>' : '<span class="badge">New</span>';
        return `
          <div class="item ${active}" data-id="${s.id}">
            <div><div class="title">${s.title}</div><div class="sub">~${s.minutes} min • ${s.audience}</div></div>
            <div class="badges">${status}</div>
          </div>`;
      }).join('');
      [...$list.querySelectorAll('.item')].forEach(el => {
        el.addEventListener('click', () => load(el.dataset.id));
      });
    }

    function load(id){
      const s = SURVEYS.find(x => x.id === id);
      if(!s) return;
      current = s;
      $title.textContent = s.title;
      $meta.textContent = `~${s.minutes} min • ${s.audience}`;
      const done = isDone(id);
      $badge.textContent = done ? 'Completed' : 'New';
      $badge.className = done ? 'badge done' : 'badge';
      $frame.src = s.url;
      renderList(id);
    }

    function nextUnfinished(){
      const idx = current ? SURVEYS.findIndex(s => s.id === current.id) : -1;
      for(let i = 1; i <= SURVEYS.length; i++){
        const j = (idx + i) % SURVEYS.length;
        if(!isDone(SURVEYS[j].id)) return load(SURVEYS[j].id);
      }
      alert('All micro surveys completed on this device — thank you!');
    }

    $mark.addEventListener('click', () => {
      if(!current) return;
      setDone(current.id);
      load(current.id);
    });
    $next.addEventListener('click', nextUnfinished);

    renderList();
    if(SURVEYS[0]) load(SURVEYS[0].id);
  </script>
</body>
</html>
