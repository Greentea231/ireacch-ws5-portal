<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>I-REACCH | Best Practices</title>

  <!-- Reuse your existing styles (optional) -->
  <link rel="stylesheet" href="assets/css/brand.css" />
  <link rel="stylesheet" href="assets/css/header.css" />
  <link rel="stylesheet" href="style.css" />

  <!-- Minimal, page-scoped styling so it looks neat even without the site CSS -->
  <style>
    :root {
      --bg: #f7fafb;
      --panel: #ffffff;
      --ink: #1c2733;
      --muted: #5b6672;
      --border: #e6ecf1;
      --primary: #4a1ea8;
      --primary-ink: #270a73;
      --chip: #eef2f7;
      --adopt: #2ea44f;
      --consider: #e3a008;
      --notfor: #cf3d3d;
    }
    body { background: var(--bg); color: var(--ink); font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif; }
    .container { max-width: 1200px; margin: 32px auto; padding: 0 16px; }
    .page-title { font-size: clamp(1.6rem, 2.2vw, 2.2rem); font-weight: 800; margin-bottom: 8px; }
    .page-sub { color: var(--muted); margin-bottom: 24px; }

    .grid { display: grid; grid-template-columns: 380px 1fr; gap: 24px; }
    @media (max-width: 960px) { .grid { grid-template-columns: 1fr; } }

    .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 16px; box-shadow: 0 10px 24px rgba(28,39,51,.04); }
    .panel > .p { padding: 20px; }
    .panel h3 { margin: 0 0 10px; font-size: 1.1rem; }
    .panel label { display:block; font-weight: 600; margin: 14px 0 6px; }
    .panel input[type="text"], .panel select, .panel textarea {
      width: 100%; padding: 12px 14px; border: 1px solid var(--border); border-radius: 10px; font: inherit; background: #fff;
    }
    .panel textarea { min-height: 120px; resize: vertical; }

    .row { display:flex; gap: 10px; align-items: center; }
    .btn {
      appearance: none; border: 0; border-radius: 999px; padding: 10px 16px; font-weight: 700; cursor: pointer;
      background: linear-gradient(90deg,#4a1ea8,#0aa0ff); color: #fff;
    }
    .btn.secondary { background: #eef2f7; color: var(--ink); font-weight: 600; }
    .btn.ghost { background: transparent; border: 1px solid var(--border); color: var(--ink); }

    /* Right column (browse) */
    .toolbar { display:flex; gap: 12px; flex-wrap: wrap; margin-bottom: 12px; }
    .toolbar .field { flex: 1 1 280px; }
    .toolbar input, .toolbar select { width:100%; padding: 12px 14px; border:1px solid var(--border); border-radius: 10px; }

    .cards { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 1100px) { .cards { grid-template-columns: 1fr; } }

    .card { border: 1px solid var(--border); border-radius: 16px; background:#fff; padding: 18px; display:flex; flex-direction: column; gap: 10px; }
    .card h4 { margin: 0; font-size: 1.05rem; }
    .badge { display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; background:var(--chip); color: var(--muted); font-weight:600; font-size:.86rem; }
    .school { background:#eaf5ff; color:#0c5ea8; }
    .tags { display:flex; gap:8px; flex-wrap: wrap; }
    .chip { background: var(--chip); color: var(--muted); padding:4px 10px; border-radius:999px; font-weight:600; font-size:.82rem; }

    .cta-line { display:flex; gap:8px; flex-wrap: wrap; align-items:center; margin-top: 6px; }
    .vote { display:flex; gap:6px; align-items:center; }
    .vote button {
      border:1px solid var(--border); background:#fff; color:var(--ink);
      border-radius: 999px; padding:8px 10px; font-weight:700; cursor:pointer;
    }
    .vote button.adopt { border-color: color-mix(in srgb, var(--adopt) 40%, var(--border)); }
    .vote button.consider { border-color: color-mix(in srgb, var(--consider) 45%, var(--border)); }
    .vote button.notfor { border-color: color-mix(in srgb, var(--notfor) 45%, var(--border)); }
    .vote .count { font-size:.86rem; color: var(--muted); padding: 0 6px; }
    .vote button.active { color:#fff; }
    .vote button.active.adopt { background: var(--adopt); }
    .vote button.active.consider { background: var(--consider); }
    .vote button.active.notfor { background: var(--notfor); }

    .muted { color: var(--muted); }
    .sep { height:1px; background:var(--border); margin: 2px 0; border-radius: 1px; }
    .empty { padding: 18px; color: var(--muted); border: 1px dashed var(--border); border-radius: 12px; background:#fff; }
    .hint { font-size:.9rem; color: var(--muted); }
  </style>
</head>
<body>

  <!-- OPTIONAL: reuse your site header include/nav here -->

  <main class="container">
    <h1 class="page-title">Best Practices (Open Space)</h1>
    <p class="page-sub">Share practical ideas and see what peers are adopting across Schools and Colleges.</p>

    <div class="grid">
      <!-- Left: Submit -->
      <section class="panel">
        <div class="p">
          <h3>Submit a practice</h3>
          <label for="bp-title">Title</label>
          <input id="bp-title" type="text" placeholder="e.g., Mentoring circles for new PGRs" />

          <label for="bp-school">School / College</label>
          <select id="bp-school">
            <option value="">Select…</option>
            <option>College of Social Sciences, Arts & Humanities</option>
            <option>College of Life Sciences</option>
            <option>College of Science & Engineering</option>
            <option>Doctoral College / PGR</option>
            <option>Central / Professional Services</option>
          </select>

          <label for="bp-desc">Description</label>
          <textarea id="bp-desc" placeholder="How does it work? Who benefits? Any tips to adopt?"></textarea>

          <label for="bp-tags">Tags (optional, comma-separated)</label>
          <input id="bp-tags" type="text" placeholder="mentoring, onboarding, community" />

          <div class="row" style="margin-top:12px;">
            <button class="btn" id="bp-add">Add practice</button>
            <button class="btn ghost" id="bp-clear">Clear</button>
          </div>
          <p class="hint" style="margin-top:10px;">Please avoid personal data. Submissions are lightly moderated before publishing.</p>
        </div>
      </section>

      <!-- Right: Browse -->
      <section>
        <div class="panel p">
          <h3>Browse practices</h3>
          <div class="toolbar">
            <div class="field">
              <input id="q" type="text" placeholder="Search title or description…" />
            </div>
            <div class="field" style="max-width:320px;">
              <select id="filter-school">
                <option value="">All Schools / Colleges</option>
                <option>College of Social Sciences, Arts & Humanities</option>
                <option>College of Life Sciences</option>
                <option>College of Science & Engineering</option>
                <option>Doctoral College / PGR</option>
                <option>Central / Professional Services</option>
              </select>
            </div>
          </div>

          <div id="cards" class="cards"></div>
          <div id="empty" class="empty" style="display:none;">No practices yet—be the first to share.</div>
        </div>
      </section>
    </div>
  </main>

  <script>
    /* -----------------------------
       Minimal in-page data model
       (Replace with an API later)
    ------------------------------ */
    const seedData = [
      {
        id: "p1",
        title: "Transparent workload board",
        school: "College of Social Sciences, Arts & Humanities",
        desc: "Team-visible board mapping roles and time allocations; updated monthly.",
        tags: ["transparency", "workload"],
        votes: { adopted: 3, considering: 1, notfor: 0 }
      },
      {
        id: "p2",
        title: "Mentoring circles for new PGRs",
        school: "Doctoral College / PGR",
        desc: "Monthly peer circles with a rotating facilitator to share challenges and signpost support.",
        tags: ["mentoring", "onboarding", "community"],
        votes: { adopted: 0, considering: 0, notfor: 0 }
      }
    ];

    const state = {
      data: [...seedData],
      query: "",
      school: "",
    };

    /* -----------------------------
       Elements
    ------------------------------ */
    const cardsEl = document.getElementById("cards");
    const emptyEl = document.getElementById("empty");
    const qEl = document.getElementById("q");
    const filterSchoolEl = document.getElementById("filter-school");

    const titleEl = document.getElementById("bp-title");
    const schoolEl = document.getElementById("bp-school");
    const descEl = document.getElementById("bp-desc");
    const tagsEl = document.getElementById("bp-tags");
    const addBtn = document.getElementById("bp-add");
    const clearBtn = document.getElementById("bp-clear");

    /* -----------------------------
       Helpers
    ------------------------------ */
    const uid = () => "p" + Math.random().toString(36).slice(2, 9);

    const saveVoteForUser = (practiceId, choice) => {
      const key = "bp-vote-" + practiceId;
      localStorage.setItem(key, choice); // 'adopted' | 'considering' | 'notfor'
    };

    const getVoteForUser = (practiceId) => {
      const key = "bp-vote-" + practiceId;
      return localStorage.getItem(key);
    };

    function normalize(str) { return (str || "").toLowerCase(); }

    function filtered() {
      const q = normalize(state.query);
      const s = state.school;
      return state.data.filter(p => {
        const text = `${p.title} ${p.desc} ${p.tags?.join(" ")}`.toLowerCase();
        const matchesText = !q || text.includes(q);
        const matchesSchool = !s || p.school === s;
        return matchesText && matchesSchool;
      });
    }

    /* -----------------------------
       Render
    ------------------------------ */
    function render() {
      const items = filtered();
      cardsEl.innerHTML = "";
      emptyEl.style.display = items.length ? "none" : "block";

      for (const p of items) {
        const userVote = getVoteForUser(p.id);

        const card = document.createElement("div");
        card.className = "card";

        // Title + school
        const head = document.createElement("div");
        head.innerHTML = `
          <h4>${escapeHtml(p.title)}</h4>
          <div class="row" style="gap:8px;">
            <span class="badge school">${escapeHtml(p.school)}</span>
          </div>
        `;
        card.appendChild(head);

        // Description
        const desc = document.createElement("div");
        desc.className = "muted";
        desc.textContent = p.desc;
        card.appendChild(desc);

        // Tags
        if (p.tags?.length) {
          const t = document.createElement("div");
          t.className = "tags";
          p.tags.forEach(tag => {
            const chip = document.createElement("span");
            chip.className = "chip";
            chip.textContent = tag;
            t.appendChild(chip);
          });
          card.appendChild(t);
        }

        card.appendChild(el("div", "sep"));

        // Voting line
        const cta = document.createElement("div");
        cta.className = "cta-line";

        const votes = document.createElement("div");
        votes.className = "vote";

        // Buttons
        const b1 = makeVoteBtn("Adopted", "adopt", userVote === "adopted");
        const b2 = makeVoteBtn("Considering", "consider", userVote === "considering");
        const b3 = makeVoteBtn("Not for us", "notfor", userVote === "notfor");

        const counters = document.createElement("span");
        counters.className = "count";
        counters.textContent = `· ${p.votes.adopted} adopted · ${p.votes.considering} considering · ${p.votes.notfor} not for us`;

        // Handlers
        b1.onclick = () => handleVote(p, "adopted");
        b2.onclick = () => handleVote(p, "considering");
        b3.onclick = () => handleVote(p, "notfor");

        votes.append(b1, b2, b3, counters);
        cta.appendChild(votes);
        card.appendChild(cta);

        cardsEl.appendChild(card);
      }
    }

    function el(tag, className, text) {
      const x = document.createElement(tag);
      if (className) x.className = className;
      if (text) x.textContent = text;
      return x;
    }

    function makeVoteBtn(label, type, active) {
      const b = document.createElement("button");
      b.textContent = label;
      b.className = " " + (type === "adopt" ? "adopt" : type === "consider" ? "consider" : "notfor");
      b.classList.add("adopt","consider","notfor"); // ensure border tone
      b.className = " " + (type === "adopt" ? "adopt" : type === "consider" ? "consider" : "notfor");
      b.classList.add("adopt","consider","notfor"); // reset then set style
      b.className = "vote-btn " + (type === "adopt" ? "adopt" : type === "consider" ? "consider" : "notfor");
      if (active) b.classList.add("active");
      return b;
    }

    function handleVote(p, choice) {
      // Undo previous vote
      const prev = getVoteForUser(p.id);
      if (prev && p.votes[prev] !== undefined) {
        p.votes[prev] = Math.max(0, p.votes[prev] - 1);
      }
      // Apply new vote
      p.votes[choice] = (p.votes[choice] || 0) + 1;
      saveVoteForUser(p.id, choice);
      render();
    }

    function escapeHtml(s) {
      return (s || "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    /* -----------------------------
       Events
    ------------------------------ */
    qEl.addEventListener("input", (e)=>{ state.query = e.target.value; render(); });
    filterSchoolEl.addEventListener("change", (e)=>{ state.school = e.target.value; render(); });

    addBtn.addEventListener("click", () => {
      const title = titleEl.value.trim();
      const school = schoolEl.value.trim();
      const desc = descEl.value.trim();
      if (!title || !school || !desc) { alert("Please fill Title, School/College, and Description."); return; }

      const tags = tagsEl.value
        .split(",")
        .map(t => t.trim())
        .filter(Boolean);

      state.data.unshift({
        id: uid(),
        title, school, desc, tags,
        votes: { adopted: 0, considering: 0, notfor: 0 }
      });
      titleEl.value = ""; schoolEl.value = ""; descEl.value = ""; tagsEl.value = "";
      render();
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    clearBtn.addEventListener("click", () => {
      titleEl.value = ""; schoolEl.value = ""; descEl.value = ""; tagsEl.value = "";
      titleEl.focus();
    });

    /* -----------------------------
       Init
    ------------------------------ */
    render();
  </script>
</body>
</html>
